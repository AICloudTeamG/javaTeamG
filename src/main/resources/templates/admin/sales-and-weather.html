<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>é€±é–“å¤©æ°—ã¨ãƒ“ãƒ¼ãƒ«å£²ä¸Š</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSSã¯å¤‰æ›´ãªã—ã€ä»¥å‰ã®ã‚‚ã®ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fffef9;
            color: #2c2c2c;
            margin: 0;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 160px;
            height: 100vh;
            background-color: #fff3e0;
            padding-top: 2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 999;
        }

        .sidebar button {
            width: 120px;
            margin: 0.5rem 0;
            padding: 0.5rem;
            font-size: 0.95rem;
            background-color: #fb8500;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .sidebar button:hover {
            background-color: #d95d0c;
        }

        .main-content {
            margin-left: 180px;
            padding: 2rem;
        }

        h1 {
            text-align: center;
            color: #fb8500;
            font-size: 1.8rem;
            margin-bottom: 2rem;
        }

        .summary-box {
            text-align: center;
            background-color: #ffebc1;
            border-left: 6px solid #fb8500;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            font-size: 1.2rem;
        }

        .beer-buttons,
        .calendar-nav {
            text-align: center;
            margin-bottom: 1rem;
        }

        .beer-buttons button,
        .calendar-nav button {
            background-color: #fb8500;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            margin: 0 0.5rem;
            border-radius: 6px;
            cursor: pointer;
        }

        .beer-buttons button.active,
        .beer-buttons button:hover,
        .calendar-nav button:hover {
            background-color: #d95d0c;
            font-weight: bold;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .day-box {
            background: white;
            border-left: 4px solid #ffb703;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .day-box h3 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .day-box p {
            margin: 0.2rem 0;
            font-size: 0.85rem;
        }

        #chart-container {
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .weather-icon {
            position: fixed;
            top: 20px;
            right: 30px;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 1001;
        }

        .weather-popup {
            position: fixed;
            top: 60px;
            right: 30px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
            width: 220px;
            font-size: 0.95rem;
        }

        .weather-popup span {
            display: block;
            margin-bottom: 4px;
        }

        .weather-popup .controls {
            text-align: center;
            margin-top: 10px;
        }

        .weather-popup button {
            background-color: #fb8500;
            color: white;
            border: none;
            padding: 4px 10px;
            margin: 0 5px;
            border-radius: 5px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .weather-popup button:hover {
            background-color: #d95d0c;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <button th:if="${isAdmin}" onclick="location.href='/admin/prediction'">ğŸ“¦ ç™ºæ³¨äºˆæ¸¬</button>
        <button th:if="${isAdmin}" onclick="location.href='/admin/dashboard'">â›… å¤©æ°—å¯è¦–åŒ–</button>
        <button onclick="location.href='/sales/input'">âœï¸ å®Ÿç¸¾å…¥åŠ›</button>
        <button th:if="${isAdmin}" onclick="location.href='/admin/account'">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</button>
        <button th:if="${isAdmin}" onclick="location.href='/admin/products'">å•†å“ç®¡ç†</button>
        <button onclick="location.href='/logout'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>

    <div class="main-content">
        <div class="weather-icon" onclick="toggleWeatherPopup()">â›…</div>
        <div class="weather-popup" id="weatherPopup">
            <div th:if="${todayWeather != null}" id="weatherContent">
                <strong>ä»Šæ—¥ã®å¤©æ°—æƒ…å ±</strong><br>
                <span style="font-size: 0.85rem; color: #555;"
                    th:text="${#temporals.format(todayWeather.date, 'MM/dd')} + 'ï¼ˆ' + ${#temporals.format(todayWeather.date, 'EEE', new java.util.Locale('ja', 'JP'))} + 'ï¼‰'"></span><br>
                <span th:text="${todayWeatherCondition}"></span><br>
                <span th:text="${todayWeather.temperatureMin}"></span>â„ƒ ~ <span
                    th:text="${todayWeather.temperatureMax}"></span>â„ƒ<br>
                <span>ğŸŒ¬ï¸é¢¨é€Ÿï¼š<span th:text="${todayWeather.windspeedMax}"></span> m/s (æœ€å¤§)</span><br>
                <span>ğŸ’§æ¹¿åº¦ï¼š<span th:text="${todayWeather.humidityMin}"></span>% ~ <span
                        th:text="${todayWeather.humidityMax}"></span>%</span>
            </div>
            <div th:unless="${todayWeather != null}" id="weatherContent">
                ä»Šæ—¥ã®å¤©æ°—æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
            </div>
        </div>

        <h1>ğŸº ãƒ“ãƒ¼ãƒ«å£²ä¸Šã¨é€±é–“å¤©æ°—</h1>
        <div class="summary-box" id="dailySummary">ä»Šæ—¥ã®å£²ä¸Šï¼š-- å††</div>
        <div class="beer-buttons">
            <button class="active" onclick="changeBeer('total', event)"><strong>å…¨ä½“å£²ä¸Š</strong></button>
            <button th:each="productName : ${beerCategories}" th:attr="onclick=|changeBeer('${productName}', event)|"
                th:text="${productName}"> å•†å“å
            </button>
        </div>
        <div class="calendar-nav">
            <button onclick="changeWeek(-1)">â—€ å‰ã®é€±</button>
            <span id="weekRange">2025/6/9 ~ 2025/6/15</span>
            <button onclick="changeWeek(1)">æ¬¡ã®é€± â–¶</button>
        </div>
        <div id="chart-container">
            <canvas id="salesChart"></canvas>
        </div>
        <div class="calendar" id="calendar"></div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/

        const beerPrice = 580; // ãƒ“ãƒ¼ãƒ«å˜ä¾¡ã¯å›ºå®šã¨ã—ã¦ãŠãï¼ˆDBã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼‰

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸåˆæœŸãƒ‡ãƒ¼ã‚¿
        let weeklyChartData = [[${ initialChartData }]];
        let currentWeekStart = new Date([[${ initialWeekStart }]]);
        let currentBeer = 'total'; // åˆæœŸè¡¨ç¤ºã¯å…¨ä½“å£²ä¸Š

        let salesChart;

        // weatherCodeIdã‹ã‚‰çµµæ–‡å­—ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚° (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨åˆã‚ã›ã‚‹)
        const weatherCodeToEmojiMap = {
            0: "â˜€ï¸", // Clear sky
            1: "â˜ï¸", // Mainly clear
            2: "â˜ï¸", // Partly cloudy
            3: "â˜ï¸", // Overcast
            45: "ğŸŒ«ï¸", // Fog
            48: "ğŸŒ«ï¸", // Depositing rime fog
            51: "ğŸŒ§ï¸", // Drizzle: Light
            53: "ğŸŒ§ï¸", // Drizzle: Moderate
            55: "ğŸŒ§ï¸", // Drizzle: Dense intensity
            56: "ğŸŒ¨ï¸", // Freezing Drizzle: Light
            57: "ğŸŒ¨ï¸", // Freezing Drizzle: Dense intensity
            61: "ğŸŒ§ï¸", // Rain: Slight
            63: "ğŸŒ§ï¸", // Rain: Moderate
            65: "ğŸŒ§ï¸", // Rain: Heavy intensity
            66: "ğŸŒ¨ï¸", // Freezing Rain: Light
            67: "ğŸŒ¨ï¸", // Freezing Rain: Heavy intensity
            71: "ğŸŒ¨ï¸", // Snow fall: Slight
            73: "ğŸŒ¨ï¸", // Snow fall: Moderate
            75: "ğŸŒ¨ï¸", // Snow fall: Heavy intensity
            77: "â„ï¸", // Snow grains
            80: "â›ˆï¸", // Rain showers: Slight
            81: "â›ˆï¸", // Rain showers: Moderate
            82: "â›ˆï¸", // Rain showers: Violent
            85: "ğŸŒ¨ï¸", // Snow showers slight
            86: "ğŸŒ¨ï¸", // Snow showers heavy
            95: "âš¡", // Thunderstorm: Slight or moderate
            96: "ğŸŒªï¸", // Thunderstorm with slight hail
            99: "ğŸŒªï¸" // Thunderstorm with heavy hail
        };

        function getWeatherEmoji(weatherCodeId) {
            return weatherCodeToEmojiMap[weatherCodeId] || "â“"; // Unknown
        }


        /**
         * Chart.jsã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¾ãŸã¯æ›´æ–°ã™ã‚‹
         * @param {string} beerType - è¡¨ç¤ºã™ã‚‹ãƒ“ãƒ¼ãƒ«ã®ç¨®é¡ ('ale', 'lager', 'total'ãªã©)
         * @param {Array<Object>} dataForChart - 7æ—¥åˆ†ã®é›†è¨ˆæ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ (SalesWeatherChartData)
         */
        function renderChart(beerType, dataForChart) {
            const ctx = document.getElementById('salesChart').getContext('2d');

            // ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒ™ãƒ«ï¼ˆæœˆã€ç«ã€...æ—¥ï¼‰
            const labels = dataForChart.map(d => new Date(d.date).toLocaleDateString('ja-JP', { weekday: 'short' }));

            // å£²ä¸Šãƒ‡ãƒ¼ã‚¿
            const salesData = dataForChart.map(d => {
                if (beerType === 'total') {
                    return d.totalSalesAmount; // å…¨ä½“å£²ä¸Š
                } else {
                    // JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚­ãƒ¼ã‚’ç¢ºèª
                    // ä¾‹: 'ãƒ›ãƒ¯ã‚¤ãƒˆãƒ“ãƒ¼ãƒ«' -> 'ãƒ›ãƒ¯ã‚¤ãƒˆãƒ“ãƒ¼ãƒ«' ã¾ãŸã¯ 'whiteBeer'
                    // ã“ã“ã§ã¯DBã®å•†å“åã¨HTMLã®ãƒœã‚¿ãƒ³ã®å•†å“åãŒä¸€è‡´ã™ã‚‹ã¨ä»®å®š
                    return d.salesAmounts[beerType] || 0; // å€‹åˆ¥å•†å“å£²ä¸Š
                }
            });

            // æ°—æ¸©ãƒ‡ãƒ¼ã‚¿ï¼ˆå¹³å‡æ°—æ¸©ã‚’ä½¿ç”¨ï¼‰
            const tempMeanData = dataForChart.map(d => parseFloat(d.temperatureMean));


            const config = {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'å£²ä¸Šé‡‘é¡ï¼ˆå††ï¼‰',
                            data: salesData,
                            borderColor: '#fb8500',
                            backgroundColor: 'rgba(251, 133, 0, 0.5)', // åŠé€æ˜ã®å¡—ã‚Šã¤ã¶ã—
                            borderWidth: 1, // æ£’ã‚°ãƒ©ãƒ•ã®æ ç·š
                            yAxisID: 'y-sales', // æ£’ã‚°ãƒ©ãƒ•ç”¨ã®Yè»¸ID
                        },
                        {
                            label: 'å¹³å‡æ°—æ¸©ï¼ˆâ„ƒï¼‰',
                            data: tempMeanData,
                            type: 'line', // æ°—æ¸©ã¯ç·šã‚°ãƒ©ãƒ•
                            borderColor: '#219ebc',
                            backgroundColor: 'rgba(33, 158, 188, 0.2)',
                            fill: true, // ç·šã‚°ãƒ©ãƒ•ã®ä¸‹ã‚’å¡—ã‚Šã¤ã¶ã™
                            tension: 0.3,
                            yAxisID: 'y-temp', // ç·šã‚°ãƒ©ãƒ•ç”¨ã®Yè»¸ID
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // ã‚³ãƒ³ãƒ†ãƒŠã«åˆã‚ã›ã¦ã‚µã‚¤ã‚ºèª¿æ•´
                    scales: {
                        'y-sales': {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'å£²ä¸Šé‡‘é¡ï¼ˆå††ï¼‰'
                            },
                            beginAtZero: true,
                        },
                        'y-temp': {
                            type: 'linear',
                            position: 'right',
                            grid: {
                                drawOnChartArea: false // ã‚°ãƒ©ãƒ•æç”»ã‚¨ãƒªã‚¢ã«ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»ã—ãªã„
                            },
                            title: {
                                display: true,
                                text: 'å¹³å‡æ°—æ¸©ï¼ˆâ„ƒï¼‰'
                            },
                            beginAtZero: false, // æ°—æ¸©ã¯0ã‹ã‚‰å§‹ã¾ã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹
                            min: Math.min(...tempMeanData) - 5, // æ°—æ¸©ã®æœ€å°å€¤ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨­å®š
                            max: Math.max(...tempMeanData) + 5, // æ°—æ¸©ã®æœ€å¤§å€¤ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨­å®š
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.dataset.label.includes('å£²ä¸Š')) {
                                            label += new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', minimumFractionDigits: 0 }).format(context.parsed.y);
                                        } else {
                                            label += context.parsed.y + 'â„ƒ';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            };

            if (salesChart) salesChart.destroy(); // æ—¢å­˜ã®ã‚°ãƒ©ãƒ•ãŒã‚ã‚Œã°ç ´æ£„
            salesChart = new Chart(ctx, config);
        }

        /**
         * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºéƒ¨åˆ†ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
         * @param {Date} startDate - é€±ã®é–‹å§‹æ—¥ï¼ˆDateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
         * @param {Array<Object>} dataForCalendar - 7æ—¥åˆ†ã®é›†è¨ˆæ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ (SalesWeatherChartData)
         */
        function renderCalendar(startDate, dataForCalendar) {
            const calendarDiv = document.getElementById('calendar');
            calendarDiv.innerHTML = ''; // ã‚¯ãƒªã‚¢

            const weekRangeSpan = document.getElementById('weekRange');
            const weekStartStr = startDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'numeric', day: 'numeric' });
            const weekEnd = new Date(startDate);
            weekEnd.setDate(weekEnd.getDate() + 6);
            const weekEndStr = weekEnd.toLocaleDateString('ja-JP', { year: 'numeric', month: 'numeric', day: 'numeric' });
            weekRangeSpan.textContent = `${weekStartStr} ~ ${weekEndStr}`;

            let todayTotalSales = 0;
            const today = new Date();
            const todayDateStr = today.toISOString().slice(0, 10); // YYYY-MM-DD

            dataForCalendar.forEach(data => {
                const day = new Date(data.date); // ISOå½¢å¼ã®æ–‡å­—åˆ—ã‹ã‚‰Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                const isToday = data.date === todayDateStr; // æ—¥ä»˜æ–‡å­—åˆ—ã§æ¯”è¼ƒ

                if (isToday) {
                    todayTotalSales = data.totalSalesAmount;
                }

                const div = document.createElement('div');
                div.className = 'day-box';
                div.innerHTML = `
                    <h3>${day.toLocaleDateString('ja-JP', { weekday: 'short', day: 'numeric' })}</h3>
                    <p>${data.weatherCondition}</p>
                    <p>å£²ä¸Šé‡‘é¡: ${data.totalSalesAmount.toLocaleString()} å††</p>
                    <p>å¹³å‡æ°—æ¸©: ${data.temperatureMean}â„ƒ</p>
                    <p>æœ€é«˜: ${data.temperatureMax}â„ƒ / æœ€ä½: ${data.temperatureMin}â„ƒ</p>
                    <p>æ¹¿åº¦: ${data.humidityMin}% ~ ${data.humidityMax}%</p>
                    <p>é¢¨é€Ÿ: ${data.windspeedMax} m/s</p>
                `;
                calendarDiv.appendChild(div);
            });

            document.getElementById('dailySummary').textContent = `ä»Šæ—¥ã®å£²ä¸Šï¼š${todayTotalSales.toLocaleString()} å††`;
            renderChart(currentBeer, dataForCalendar);
        }

        /**
         * é€±ã‚’ç§»å‹•ã™ã‚‹ (APIå‘¼ã³å‡ºã—ã‚’ä¼´ã†)
         * @param {number} offset - é€±ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ (-1:å‰é€±, 1:æ¬¡é€±)
         */
        async function changeWeek(offset) {
            currentWeekStart.setDate(currentWeekStart.getDate() + offset * 7);
            await fetchAndRenderData(currentWeekStart);
        }

        /**
         * ãƒ“ãƒ¼ãƒ«ã®ç¨®é¡ã‚’å¤‰æ›´ã™ã‚‹
         * @param {string} type - ãƒ“ãƒ¼ãƒ«ã®ç¨®é¡
         * @param {Event} event - ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function changeBeer(type, event) {
            document.querySelectorAll('.beer-buttons button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            currentBeer = type;
            // ã‚°ãƒ©ãƒ•ã®ã¿å†æç”» (ãƒ‡ãƒ¼ã‚¿ã¯æ—¢ã«å–å¾—æ¸ˆã¿)
            renderChart(currentBeer, weeklyChartData);
        }

        /**
         * å¤©æ°—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
         */
        function toggleWeatherPopup() {
            const popup = document.getElementById('weatherPopup');
            popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ãéš›ã«ä»Šæ—¥ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¦è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ (å¿µã®ãŸã‚)
            if (popup.style.display === 'block') {
                // Thymeleafã§åˆæœŸãƒ‡ãƒ¼ã‚¿ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯ç‰¹ã«ä½•ã‚‚ã—ãªã„
                // å¿…è¦ã§ã‚ã‚Œã°ã€å€‹åˆ¥ã®APIã‚³ãƒ¼ãƒ«ã‚’ã“ã“ã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
            }
        }

        /**
         * APIã‹ã‚‰é€±é–“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ã‚°ãƒ©ãƒ•ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
         * @param {Date} startDate - å–å¾—ã—ãŸã„é€±ã®é–‹å§‹æ—¥
         */
        async function fetchAndRenderData(startDate) {
            const formattedStartDate = startDate.toISOString().slice(0, 10); // YYYY-MM-DDå½¢å¼
            try {
                const response = await fetch(`/admin/dashboard/api/weekly-sales-weather?startDate=${formattedStartDate}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                weeklyChartData = data; // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                renderCalendar(startDate, weeklyChartData); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã‚°ãƒ©ãƒ•ã‚’å†æç”»
            } catch (error) {
                console.error("é€±é–“ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
                alert("é€±é–“ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚");
                // ã‚¨ãƒ©ãƒ¼æ™‚ã®UIè¡¨ç¤ºãªã©ã‚’è€ƒæ…®
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸå‡¦ç†
        window.onload = async () => {
            // Thymeleafã‹ã‚‰æ¸¡ã•ã‚ŒãŸåˆæœŸãƒ‡ãƒ¼ã‚¿ã§æœ€åˆã®æç”»
            if (weeklyChartData && weeklyChartData.length > 0) {
                renderCalendar(currentWeekStart, weeklyChartData);
            } else {
                // ãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œãªã‹ã£ãŸå ´åˆï¼ˆã‚¨ãƒ©ãƒ¼ãªã©ï¼‰ã¯APIã‚’å‘¼ã³å‡ºã™
                console.warn("åˆæœŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚");
                await fetchAndRenderData(currentWeekStart);
            }

            // åˆæœŸé¸æŠãƒœã‚¿ãƒ³ã‚’è¨­å®š (å…¨ä½“å£²ä¸Š)
            document.querySelector('.beer-buttons button:first-child').classList.add('active');
        };

        /*]]>*/
    </script>
</body>

</html>