
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>週間天気とビール売上</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #fffef9;
      color: #2c2c2c;
      margin: 0;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 160px;
      height: 100vh;
      background-color: #fff3e0;
      padding-top: 2rem;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 999;
    }

    .sidebar button {
      width: 120px;
      margin: 0.5rem 0;
      padding: 0.5rem;
      font-size: 0.95rem;
      background-color: #fb8500;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .sidebar button:hover {
      background-color: #d95d0c;
    }

    .main-content {
      margin-left: 180px;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #fb8500;
      font-size: 1.8rem;
      margin-bottom: 2rem;
    }

    .summary-box {
      text-align: center;
      background-color: #ffebc1;
      border-left: 6px solid #fb8500;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 10px;
      font-size: 1.2rem;
    }

    .beer-buttons, .calendar-nav {
      text-align: center;
      margin-bottom: 1rem;
    }

    .beer-buttons button, .calendar-nav button {
      background-color: #fb8500;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      margin: 0 0.5rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .beer-buttons button.active, .beer-buttons button:hover,
    .calendar-nav button:hover {
      background-color: #d95d0c;
      font-weight: bold;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .day-box {
      background: white;
      border-left: 4px solid #ffb703;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .day-box h3 {
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .day-box p {
      margin: 0.2rem 0;
      font-size: 0.85rem;
    }

    #chart-container {
      max-width: 800px;
      margin: 0 auto 2rem;
    }

    .weather-icon {
      position: fixed;
      top: 20px;
      right: 30px;
      font-size: 1.8rem;
      cursor: pointer;
      z-index: 1001;
    }

    .weather-popup {
      position: fixed;
      top: 60px;
      right: 30px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      display: none;
      z-index: 1000;
      width: 220px;
      font-size: 0.95rem;
    }

    .weather-popup span {
      display: block;
      margin-bottom: 4px;
    }

    .weather-popup .controls {
      text-align: center;
      margin-top: 10px;
    }

    .weather-popup button {
      background-color: #fb8500;
      color: white;
      border: none;
      padding: 4px 10px;
      margin: 0 5px;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .weather-popup button:hover {
      background-color: #d95d0c;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <button onclick="location.href='/forecast'">📦 発注予測</button>
    <button onclick="location.href='/weather'">⛅ 天気可視化</button>
    <button onclick="location.href='/input'">✍️ 実績入力</button>
    <button onclick="location.href='/account'">👤 アカウント管理</button>
  </div>

  <div class="main-content">
    <div class="weather-icon" onclick="toggleWeatherPopup()">⛅</div>
    <div class="weather-popup" id="weatherPopup">
      <div id="weatherContent"></div>
      <div class="controls">
        <button onclick="changeWeather(-1)">←</button>
        <button onclick="changeWeather(1)">→</button>
      </div>
    </div>

    <h1>🍺 ビール売上と週間天気</h1>
    <div class="summary-box" id="dailySummary">今日の売上：-- 円</div>
    <div class="beer-buttons">
      <button class="active" onclick="changeBeer('ale', event)">ホワイトビール</button>
      <button onclick="changeBeer('lager', event)">ラガー</button>
      <button onclick="changeBeer('pale', event)">ペールエール</button>
      <button onclick="changeBeer('fruit', event)">フルーツビール</button>
      <button onclick="changeBeer('black', event)">黒ビール</button>
      <button onclick="changeBeer('ipa', event)">IPA</button>
      <button onclick="changeBeer('total', event)"><strong>全体売上</strong></button>
    </div>
    <div class="calendar-nav">
      <button onclick="changeWeek(-1)">◀ 前の週</button>
      <span id="weekRange">2025/6/9 ~ 2025/6/15</span>
      <button onclick="changeWeek(1)">次の週 ▶</button>
    </div>
    <div id="chart-container">
      <canvas id="salesChart"></canvas>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <script>
    const today = new Date();
    let currentWeekStart = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay() + 1);
    let currentBeer = 'ale';
    const beerPrice = 580;

    const beerData = {
      ale: [30, 45, 32, 50, 70, 90, 60],
      lager: [28, 40, 33, 47, 68, 88, 59],
      pale: [26, 38, 30, 46, 64, 82, 56],
      fruit: [22, 36, 28, 43, 60, 75, 52],
      black: [20, 32, 26, 40, 58, 72, 50],
      ipa: [25, 37, 29, 44, 62, 78, 54],
      total: []
    };

    for (let i = 0; i < 7; i++) {
      let sum = 0;
      ['ale', 'lager', 'pale', 'fruit', 'black', 'ipa'].forEach(type => {
        sum += beerData[type][i];
      });
      beerData.total.push(sum);
    }

    const tempData = [19, 20, 22, 21, 25, 27, 23];

    const dummyWeatherData = (date, beerType, index) => {
      const conditions = ['☀️ 晴れ', '☁️ 曇り', '🌧️ 雨', '⛅ 晴れ時々曇り'];
      return {
        date: date.toISOString().slice(0, 10),
        condition: conditions[Math.floor(Math.random() * conditions.length)],
        avg: (20 + Math.random() * 5).toFixed(1),
        max: (25 + Math.random() * 5).toFixed(1),
        min: (15 + Math.random() * 5).toFixed(1),
        humidity: Math.floor(40 + Math.random() * 40),
        wind: (1 + Math.random() * 3).toFixed(1),
        sales: beerData[beerType][index],
        temp: tempData[index]
      };
    };

    let salesChart;

    function renderChart(beerType) {
      const ctx = document.getElementById('salesChart').getContext('2d');
      const data = beerData[beerType];
      const config = {
        type: 'bar',
        data: {
          labels: ['月', '火', '水', '木', '金', '土', '日'],
          datasets: [
            {
              label: '売上金額（円）',
              data: data.map(x => x * beerPrice),
              borderColor: '#fb8500',
              backgroundColor: 'rgba(251, 133, 0, 0.1)',
              tension: 0.3,
              yAxisID: 'y',
            },
            {
              label: '気温（℃）',
              data: tempData,
              type: 'line',
              borderColor: '#219ebc',
              backgroundColor: 'rgba(33, 158, 188, 0.1)',
              tension: 0.3,
              yAxisID: 'y1',
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              type: 'linear',
              position: 'left',
              title: {
                display: true,
                text: '売上金額（円）'
              }
            },
            y1: {
              type: 'linear',
              position: 'right',
              grid: {
                drawOnChartArea: false
              },
              title: {
                display: true,
                text: '気温（℃）'
              }
            }
          }
        }
      };

      if (salesChart) salesChart.destroy();
      salesChart = new Chart(ctx, config);
    }

    function renderCalendar(startDate) {
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      const weekRange = document.getElementById('weekRange');
      const weekStart = new Date(startDate);
      const weekEnd = new Date(startDate);
      weekEnd.setDate(weekEnd.getDate() + 6);
      weekRange.textContent = `${weekStart.toISOString().slice(0,10)} ~ ${weekEnd.toISOString().slice(0,10)}`;

      let todayTotal = 0;
      const todayDate = new Date().toISOString().slice(0,10);

      for (let i = 0; i < 7; i++) {
        const day = new Date(startDate);
        day.setDate(day.getDate() + i);
        const w = dummyWeatherData(day, currentBeer, i);
        const isToday = w.date === todayDate;
        if (isToday) todayTotal = w.sales * beerPrice;

        const div = document.createElement('div');
        div.className = 'day-box';
        div.innerHTML = `
          <h3>${day.toLocaleDateString('ja-JP', { weekday: 'short', day: 'numeric' })}</h3>
          <p>${w.condition}</p>
          <p>売上金額: ${ (w.sales * beerPrice).toLocaleString() } 円</p>
          <p>平均気温: ${w.avg}℃</p>
          <p>最高: ${w.max}℃ / 最低: ${w.min}℃</p>
          <p>湿度: ${w.humidity}%</p>
          <p>風速: ${w.wind} m/s</p>
        `;
        calendar.appendChild(div);
      }

      document.getElementById('dailySummary').textContent = `今日の売上：${todayTotal.toLocaleString()} 円`;
      renderChart(currentBeer);
    }

    function changeWeek(offset) {
      currentWeekStart.setDate(currentWeekStart.getDate() + offset * 7);
      renderCalendar(currentWeekStart);
    }

    function changeBeer(type, event) {
      document.querySelectorAll('.beer-buttons button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      currentBeer = type;
      renderCalendar(currentWeekStart);
    }

    function toggleWeatherPopup() {
      const popup = document.getElementById('weatherPopup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
      updateWeatherContent();
    }

    function changeWeather(direction) {
      weatherIndex += direction;
      if (weatherIndex < 0) weatherIndex = 0;
      if (weatherIndex > weatherData.length - 1) weatherIndex = weatherData.length - 1;
      updateWeatherContent();
    }

    function getShortWeekday(dateObj) {
      const days = ['日', '月', '火', '水', '木', '金', '土'];
      return days[dateObj.getDay()];
    }

    function updateWeatherContent() {
      const data = weatherData[weatherIndex];
      const date = new Date();
      date.setDate(date.getDate() + data.offset);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekday = getShortWeekday(date);
      const content = document.getElementById('weatherContent');
      content.innerHTML = `<strong>${data.label}の天気情報</strong><br><span style="font-size: 0.85rem; color: #555;">${month}/${day}（${weekday}）</span>${data.tenki}<br>${data.tempLow}℃ ~ ${data.tempHigh}℃<br>🌬️風速：${data.wind}`;
    }

    const weatherData = [
      { label: '三日前', tenki: '🌤', tempLow: 18, tempHigh: 22, wind: '4 m/s', offset: -3 },
      { label: '一昨日', tenki: '☔️', tempLow: 17, tempHigh: 20, wind: '7 m/s', offset: -2 },
      { label: '昨日', tenki: '☁️', tempLow: 19, tempHigh: 23, wind: '5 m/s', offset: -1 },
      { label: '今日', tenki: '☀️', tempLow: 21, tempHigh: 26, wind: '4 m/s', offset: 0 },
      { label: '明日', tenki: '☁️', tempLow: 20, tempHigh: 24, wind: '3 m/s', offset: 1 },
      { label: '明後日', tenki: '☔️', tempLow: 18, tempHigh: 21, wind: '6 m/s', offset: 2 },
      { label: '大後日', tenki: '☀️', tempLow: 22, tempHigh: 25, wind: '2 m/s', offset: 3 }
    ];

    let weatherIndex = 3;

    window.onload = () => {
      renderCalendar(currentWeekStart);
      updateWeatherContent();
    };
  </script>
</body>
</html>
